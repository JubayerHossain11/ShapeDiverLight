{"id":"node_modules/@shapediver/viewer.rendering-engine-threejs.standard/dist/loaders/HTMLElementAnchorLoader.js","dependencies":[{"name":"D:\\projects\\myProjects\\shapeApp\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\dist\\loaders\\HTMLElementAnchorLoader.js.map","includedInParent":true,"mtime":1706527153308},{"name":"D:\\projects\\myProjects\\shapeApp\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\src\\loaders\\HTMLElementAnchorLoader.ts","includedInParent":true,"mtime":1706527154081},{"name":"D:\\projects\\myProjects\\shapeApp\\package.json","includedInParent":true,"mtime":1706533774939},{"name":"D:\\projects\\myProjects\\shapeApp\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\package.json","includedInParent":true,"mtime":1706527152875},{"name":"gl-matrix","loc":{"line":4,"column":28,"index":150},"parent":"D:\\projects\\myProjects\\shapeApp\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\dist\\loaders\\HTMLElementAnchorLoader.js","resolved":"D:\\projects\\myProjects\\shapeApp\\node_modules\\gl-matrix\\esm\\index.js"},{"name":"@shapediver/viewer.rendering-engine.rendering-engine","loc":{"line":5,"column":59,"index":224},"parent":"D:\\projects\\myProjects\\shapeApp\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\dist\\loaders\\HTMLElementAnchorLoader.js","resolved":"D:\\projects\\myProjects\\shapeApp\\node_modules\\@shapediver\\viewer.rendering-engine.rendering-engine\\dist\\index.js"}],"generated":{"js":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.HTMLElementAnchorLoader = void 0;\r\nconst gl_matrix_1 = require(\"gl-matrix\");\r\nconst viewer_rendering_engine_rendering_engine_1 = require(\"@shapediver/viewer.rendering-engine.rendering-engine\");\r\nclass HTMLElementAnchorLoader {\r\n    // #endregion Properties (2)\r\n    // #region Constructors (1)\r\n    constructor(_renderingEngine) {\r\n        this._renderingEngine = _renderingEngine;\r\n        // #region Properties (2)\r\n        this._htmlElements = {};\r\n        this._parentDiv = document.createElement('div');\r\n        this._parentDiv.style.userSelect = 'none';\r\n        this._parentDiv.style.cursor = 'default';\r\n        this._parentDiv.style.pointerEvents = 'none';\r\n        this._parentDiv.style.overflow = 'hidden';\r\n        this._parentDiv.style.position = 'absolute';\r\n        this._parentDiv.style.width = '100%';\r\n        this._parentDiv.style.height = '100%';\r\n        this._parentDiv.style.left = '0%';\r\n        this._parentDiv.style.top = '0%';\r\n    }\r\n    // #endregion Constructors (1)\r\n    // #region Public Accessors (1)\r\n    get parentDiv() {\r\n        return this._parentDiv;\r\n    }\r\n    // #endregion Public Accessors (1)\r\n    // #region Public Methods (5)\r\n    adjustPositions(scaleWidth, scaleHeight) {\r\n        for (let anchorId in this._htmlElements) {\r\n            const anchor = this._htmlElements[anchorId].anchor;\r\n            const { page, container, client, hidden } = this._renderingEngine.sceneTracingManager.convert3Dto2D(gl_matrix_1.vec3.clone(anchor.location));\r\n            const htmlElement = anchor.createViewerHtmlElement(this._renderingEngine.id);\r\n            if (!htmlElement)\r\n                continue;\r\n            let node = this._htmlElements[anchorId].node;\r\n            let visible = node.visible;\r\n            while (node.parent) {\r\n                node = node.parent;\r\n                visible = node.visible && visible;\r\n            }\r\n            if (this._renderingEngine.show === false)\r\n                visible = false;\r\n            anchor.update({ anchor, htmlElement, page, container, client, scale: gl_matrix_1.vec2.fromValues(scaleWidth, scaleHeight), hidden, visible });\r\n        }\r\n    }\r\n    init() {\r\n        var _a;\r\n        (_a = this._renderingEngine.canvas.parentNode) === null || _a === void 0 ? void 0 : _a.appendChild(this._parentDiv);\r\n    }\r\n    load(node, anchor) {\r\n        const htmlElement = anchor.createViewerHtmlElement(this._renderingEngine.id);\r\n        if (!htmlElement)\r\n            return;\r\n        if (this._renderingEngine.show === false)\r\n            htmlElement.style.display = 'none';\r\n        this._parentDiv.appendChild(htmlElement);\r\n        this._htmlElements[anchor.id + '_' + anchor.version] = {\r\n            node,\r\n            anchor\r\n        };\r\n    }\r\n    removeData(id, version) {\r\n        const anchor = this._htmlElements[id + '_' + version].anchor;\r\n        if (anchor && anchor.getViewerHtmlElement(this._renderingEngine.id)) {\r\n            this._parentDiv.removeChild(anchor.getViewerHtmlElement(this._renderingEngine.id));\r\n            delete this._htmlElements[id + '_' + version];\r\n        }\r\n    }\r\n    toggleBusyMode(toggle) {\r\n        if (toggle && this._renderingEngine.busyModeDisplay === viewer_rendering_engine_rendering_engine_1.BUSY_MODE_DISPLAY.BLUR) {\r\n            if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 && navigator.userAgent.toLowerCase().indexOf('android') > -1)\r\n                return;\r\n            this._parentDiv.style.filter = 'blur(3px)';\r\n        }\r\n        else {\r\n            this._parentDiv.style.filter = '';\r\n        }\r\n    }\r\n}\r\nexports.HTMLElementAnchorLoader = HTMLElementAnchorLoader;\r\n"},"sourceMaps":{"js":{"version":3,"file":"HTMLElementAnchorLoader.js","sourceRoot":"","sources":["../../src/loaders/HTMLElementAnchorLoader.ts"],"names":[],"mappings":"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","sourcesContent":["import { HTMLElementAnchorData } from '@shapediver/viewer.shared.types'\r\nimport { vec2, vec3 } from 'gl-matrix'\r\nimport { ITreeNode } from '@shapediver/viewer.shared.node-tree';\r\n\r\nimport { ILoader } from '../interfaces/ILoader'\r\nimport { RenderingEngine } from '../RenderingEngine'\r\nimport { BUSY_MODE_DISPLAY } from '@shapediver/viewer.rendering-engine.rendering-engine';\r\n\r\nexport class HTMLElementAnchorLoader implements ILoader {\r\n    // #region Properties (2)\r\n\r\n    private readonly _htmlElements: {\r\n        [key: string]: {\r\n            anchor: HTMLElementAnchorData,\r\n            node: ITreeNode\r\n        }\r\n    } = {};\r\n    private readonly _parentDiv: HTMLDivElement;\r\n\r\n    // #endregion Properties (2)\r\n\r\n    // #region Constructors (1)\r\n\r\n    constructor(private readonly _renderingEngine: RenderingEngine) {\r\n        this._parentDiv = document.createElement('div');\r\n        this._parentDiv.style.userSelect = 'none';\r\n        this._parentDiv.style.cursor = 'default';\r\n        this._parentDiv.style.pointerEvents = 'none';\r\n        this._parentDiv.style.overflow = 'hidden';\r\n        this._parentDiv.style.position = 'absolute';\r\n        this._parentDiv.style.width = '100%';\r\n        this._parentDiv.style.height = '100%';\r\n        this._parentDiv.style.left = '0%';\r\n        this._parentDiv.style.top = '0%';\r\n    }\r\n\r\n    // #endregion Constructors (1)\r\n\r\n    // #region Public Accessors (1)\r\n\r\n    public get parentDiv(): HTMLDivElement {\r\n        return this._parentDiv;\r\n    }\r\n\r\n    // #endregion Public Accessors (1)\r\n\r\n    // #region Public Methods (5)\r\n\r\n    public adjustPositions(scaleWidth: number, scaleHeight: number): void {\r\n        for (let anchorId in this._htmlElements) {\r\n            const anchor = this._htmlElements[anchorId].anchor;\r\n            const { page, container, client, hidden } = this._renderingEngine.sceneTracingManager.convert3Dto2D(vec3.clone(anchor.location));\r\n            \r\n            const htmlElement = anchor.createViewerHtmlElement(this._renderingEngine.id);\r\n            if (!htmlElement) continue;\r\n    \r\n            let node = this._htmlElements[anchorId].node;\r\n\r\n            let visible = node.visible;\r\n            while(node.parent) {\r\n                node = node.parent;\r\n                visible = node.visible && visible;\r\n            }\r\n\r\n            if(this._renderingEngine.show === false)\r\n                visible = false;\r\n\r\n            anchor.update({ anchor, htmlElement, page, container, client, scale: vec2.fromValues(scaleWidth, scaleHeight), hidden, visible });\r\n        }\r\n    }\r\n\r\n    public init(): void {\r\n        this._renderingEngine.canvas.parentNode?.appendChild(this._parentDiv);\r\n    }\r\n\r\n    public load(node: ITreeNode, anchor: HTMLElementAnchorData): void {\r\n        const htmlElement = anchor.createViewerHtmlElement(this._renderingEngine.id);\r\n        if (!htmlElement) return;\r\n        if(this._renderingEngine.show === false) htmlElement.style.display = 'none';\r\n        this._parentDiv.appendChild(htmlElement);\r\n        this._htmlElements[anchor.id + '_' + anchor.version] = {\r\n            node,\r\n            anchor\r\n        };\r\n    }\r\n\r\n    public removeData(id: string, version: string) {\r\n        const anchor = this._htmlElements[id + '_' + version].anchor;\r\n        if (anchor && anchor.getViewerHtmlElement(this._renderingEngine.id)) {\r\n            this._parentDiv.removeChild(anchor.getViewerHtmlElement(this._renderingEngine.id)!);\r\n            delete this._htmlElements[id + '_' + version]\r\n        }\r\n    }\r\n\r\n    public toggleBusyMode(toggle: boolean) {\r\n        if (toggle && this._renderingEngine.busyModeDisplay === BUSY_MODE_DISPLAY.BLUR) {\r\n            if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 && navigator.userAgent.toLowerCase().indexOf('android') > -1)\r\n                return;\r\n            this._parentDiv.style.filter = 'blur(3px)';\r\n        } else {\r\n            this._parentDiv.style.filter = '';\r\n        }\r\n    }\r\n\r\n    // #endregion Public Methods (5)\r\n}"]}},"error":null,"hash":"c61bff35b8af5cd5bbae77f3d41759e7","cacheData":{"env":{}}}
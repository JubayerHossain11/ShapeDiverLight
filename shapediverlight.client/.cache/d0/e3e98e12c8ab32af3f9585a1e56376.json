{"id":"node_modules/@shapediver/viewer.rendering-engine.animation-frame-engine/dist/implementation/AnimationFrameEngine.js","dependencies":[{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-frame-engine\\dist\\implementation\\AnimationFrameEngine.js.map","includedInParent":true,"mtime":1706542084758},{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-frame-engine\\src\\implementation\\AnimationFrameEngine.ts","includedInParent":true,"mtime":1706542085259},{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\package.json","includedInParent":true,"mtime":1706542184022},{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-frame-engine\\package.json","includedInParent":true,"mtime":1706542084464},{"name":"@tweenjs/tween.js","loc":{"line":29,"column":35,"index":1610},"parent":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-frame-engine\\dist\\implementation\\AnimationFrameEngine.js","resolved":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@tweenjs\\tween.js\\dist\\tween.esm.js"},{"name":"@shapediver/viewer.shared.services","loc":{"line":30,"column":41,"index":1675},"parent":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-frame-engine\\dist\\implementation\\AnimationFrameEngine.js","resolved":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.shared.services\\dist\\index.js"},{"name":"@shapediver/viewer.rendering-engine.animation-engine","loc":{"line":31,"column":59,"index":1774},"parent":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-frame-engine\\dist\\implementation\\AnimationFrameEngine.js","resolved":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine.animation-engine\\dist\\index.js"}],"generated":{"js":"\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n};\r\nvar _AnimationFrameEngine_animationEngine, _AnimationFrameEngine_uuidGenerator;\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.AnimationFrameEngine = void 0;\r\nconst TWEEN = __importStar(require(\"@tweenjs/tween.js\"));\r\nconst viewer_shared_services_1 = require(\"@shapediver/viewer.shared.services\");\r\nconst viewer_rendering_engine_animation_engine_1 = require(\"@shapediver/viewer.rendering-engine.animation-engine\");\r\nclass AnimationFrameEngine {\r\n    // #endregion Properties (5)\r\n    // #region Constructors (1)\r\n    constructor() {\r\n        // #region Properties (5)\r\n        _AnimationFrameEngine_animationEngine.set(this, viewer_rendering_engine_animation_engine_1.AnimationEngine.instance);\r\n        _AnimationFrameEngine_uuidGenerator.set(this, viewer_shared_services_1.UuidGenerator.instance);\r\n        this._animationFrameCallbacks = {};\r\n        this._lastTime = 0;\r\n        this.animate(0);\r\n    }\r\n    // #endregion Constructors (1)\r\n    // #region Public Static Accessors (1)\r\n    static get instance() {\r\n        return this._instance || (this._instance = new this());\r\n    }\r\n    // #endregion Public Static Accessors (1)\r\n    // #region Public Methods (2)\r\n    addAnimationFrameCallback(cb) {\r\n        const token = __classPrivateFieldGet(this, _AnimationFrameEngine_uuidGenerator, \"f\").create();\r\n        this._animationFrameCallbacks[token] = cb;\r\n        return token;\r\n    }\r\n    removeAnimationFrameCallback(token) {\r\n        if (!this._animationFrameCallbacks[token])\r\n            return false;\r\n        delete this._animationFrameCallbacks[token];\r\n        this._animationFrameCallbacks[token] = undefined;\r\n        return true;\r\n    }\r\n    // #endregion Public Methods (2)\r\n    // #region Private Methods (1)\r\n    animate(time) {\r\n        // animation loop - part 2: requesting and timings\r\n        requestAnimationFrame((time) => this.animate(time));\r\n        TWEEN.update(time);\r\n        const deltaTime = time - this._lastTime < 0 ? 0 : time - this._lastTime;\r\n        this._lastTime = time;\r\n        const runningAnimation = __classPrivateFieldGet(this, _AnimationFrameEngine_animationEngine, \"f\").update(deltaTime);\r\n        for (let a in this._animationFrameCallbacks)\r\n            this._animationFrameCallbacks[a](time, deltaTime, runningAnimation);\r\n    }\r\n}\r\nexports.AnimationFrameEngine = AnimationFrameEngine;\r\n_AnimationFrameEngine_animationEngine = new WeakMap(), _AnimationFrameEngine_uuidGenerator = new WeakMap();\r\n"},"sourceMaps":{"js":{"version":3,"file":"AnimationFrameEngine.js","sourceRoot":"","sources":["../../src/implementation/AnimationFrameEngine.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,yDAA0C;AAC1C,+EAAmE;AACnE,mHAAuF;AAEvF,MAAa,oBAAoB;IAa7B,4BAA4B;IAE5B,2BAA2B;IAE3B;QAhBA,yBAAyB;QAEzB,gDAA6C,0DAAe,CAAC,QAAQ,EAAC;QACtE,8CAAyC,sCAAa,CAAC,QAAQ,EAAC;QAIxD,6BAAwB,GAE5B,EAAE,CAAC;QACC,cAAS,GAAW,CAAC,CAAC;QAO1B,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IACpB,CAAC;IAED,8BAA8B;IAE9B,sCAAsC;IAE/B,MAAM,KAAK,QAAQ;QACtB,OAAO,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC,CAAC;IAC3D,CAAC;IAED,yCAAyC;IAEzC,6BAA6B;IAEtB,yBAAyB,CAAC,EAA0B;QACvD,MAAM,KAAK,GAAG,uBAAA,IAAI,2CAAe,CAAC,MAAM,EAAE,CAAC;QAC3C,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;QAE1C,OAAO,KAAK,CAAC;IACjB,CAAC;IAEM,4BAA4B,CAAC,KAAa;QAC7C,IAAG,CAAC,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC;YAAE,OAAO,KAAK,CAAC;QAEvD,OAAO,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAE,GAAG,SAAS,CAAC;QAExD,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,gCAAgC;IAEhC,8BAA8B;IAEtB,OAAO,CAAC,IAAY;QACxB,kDAAkD;QAClD,qBAAqB,CAAC,CAAC,IAAY,EAAE,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;QAC5D,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAEnB,MAAM,SAAS,GAAG,IAAI,GAAG,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC;QACxE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QAEtB,MAAM,gBAAgB,GAAG,uBAAA,IAAI,6CAAiB,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QAEjE,KAAI,IAAI,CAAC,IAAI,IAAI,CAAC,wBAAwB;YACtC,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,SAAS,EAAE,gBAAgB,CAAC,CAAC;IAC5E,CAAC;CAGJ;AApED,oDAoEC","sourcesContent":["import { AnimationFrameCallback, IAnimationFrameEngine } from \"../interfaces/IAnimationFrameEngine\";\r\nimport * as TWEEN from '@tweenjs/tween.js'\r\nimport { UuidGenerator } from \"@shapediver/viewer.shared.services\";\r\nimport { AnimationEngine } from \"@shapediver/viewer.rendering-engine.animation-engine\";\r\n\r\nexport class AnimationFrameEngine implements IAnimationFrameEngine {\r\n    // #region Properties (5)\r\n\r\n    readonly #animationEngine: AnimationEngine = AnimationEngine.instance;\r\n    readonly #uuidGenerator: UuidGenerator = UuidGenerator.instance;\r\n\r\n    private static _instance: AnimationFrameEngine;\r\n\r\n    private _animationFrameCallbacks: {\r\n        [key: string]: AnimationFrameCallback\r\n    } = {};\r\n    private _lastTime: number = 0;\r\n\r\n    // #endregion Properties (5)\r\n\r\n    // #region Constructors (1)\r\n\r\n    private constructor() {\r\n        this.animate(0);\r\n    }\r\n\r\n    // #endregion Constructors (1)\r\n\r\n    // #region Public Static Accessors (1)\r\n\r\n    public static get instance() {\r\n        return this._instance || (this._instance = new this());\r\n    }\r\n\r\n    // #endregion Public Static Accessors (1)\r\n\r\n    // #region Public Methods (2)\r\n\r\n    public addAnimationFrameCallback(cb: AnimationFrameCallback): string {\r\n        const token = this.#uuidGenerator.create();\r\n        this._animationFrameCallbacks[token] = cb;\r\n\r\n        return token;\r\n    }\r\n\r\n    public removeAnimationFrameCallback(token: string): boolean {\r\n        if(!this._animationFrameCallbacks[token]) return false;\r\n\r\n        delete this._animationFrameCallbacks[token];\r\n        (<any>this._animationFrameCallbacks[token]) = undefined;\r\n\r\n        return true;\r\n    }\r\n\r\n    // #endregion Public Methods (2)\r\n\r\n    // #region Private Methods (1)\r\n\r\n    private animate(time: number): void {\r\n        // animation loop - part 2: requesting and timings\r\n        requestAnimationFrame((time: number) => this.animate(time));\r\n        TWEEN.update(time);\r\n\r\n        const deltaTime = time - this._lastTime < 0 ? 0 : time - this._lastTime;\r\n        this._lastTime = time;\r\n\r\n        const runningAnimation = this.#animationEngine.update(deltaTime);\r\n\r\n        for(let a in this._animationFrameCallbacks)\r\n            this._animationFrameCallbacks[a](time, deltaTime, runningAnimation);\r\n    }\r\n\r\n    // #endregion Private Methods (1)\r\n}"]}},"error":null,"hash":"647ea0cdfac5fca107fcfaea0a45d2e3","cacheData":{"env":{}}}
{"id":"bU8u","dependencies":[{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\dist\\three\\shaders\\DepthLimitedBlurShader.js.map","includedInParent":true,"mtime":1706476151853},{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\src\\three\\shaders\\DepthLimitedBlurShader.js","includedInParent":true,"mtime":1706476150476},{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\package.json","includedInParent":true,"mtime":1706476652643},{"name":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\package.json","includedInParent":true,"mtime":1706476151754},{"name":"three","loc":{"line":4,"column":24,"index":171},"parent":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\@shapediver\\viewer.rendering-engine-threejs.standard\\dist\\three\\shaders\\DepthLimitedBlurShader.js","resolved":"F:\\UpworkProjects\\ShapeDiverLight\\ShapeDiverLight\\shapediverlight.client\\node_modules\\three\\build\\three.module.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.BlurShaderUtils=exports.DepthLimitedBlurShader=void 0;const t=require(\"three\"),e={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new t.Vector2(512,512)},sampleUvOffsets:{value:[new t.Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:\"\\n\\n\\t\\t#include <common>\\n\\n\\t\\tuniform vec2 size;\\n\\n\\t\\tvarying vec2 vUv;\\n\\t\\tvarying vec2 vInvSize;\\n\\n\\t\\tvoid main() {\\n\\t\\t\\tvUv = uv;\\n\\t\\t\\tvInvSize = 1.0 / size;\\n\\n\\t\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\t\\t}\",fragmentShader:\"\\n\\n\\t\\t#include <common>\\n\\t\\t#include <packing>\\n\\n\\t\\tuniform sampler2D tDiffuse;\\n\\t\\tuniform sampler2D tDepth;\\n\\n\\t\\tuniform float cameraNear;\\n\\t\\tuniform float cameraFar;\\n\\t\\tuniform float depthCutoff;\\n\\n\\t\\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\\n\\t\\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\\n\\n\\t\\tvarying vec2 vUv;\\n\\t\\tvarying vec2 vInvSize;\\n\\n\\t\\tfloat getDepth( const in vec2 screenPosition ) {\\n\\t\\t\\t#if DEPTH_PACKING == 1\\n\\t\\t\\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\\n\\t\\t\\t#else\\n\\t\\t\\treturn texture2D( tDepth, screenPosition ).x;\\n\\t\\t\\t#endif\\n\\t\\t}\\n\\n\\t\\tfloat getViewZ( const in float depth ) {\\n\\t\\t\\t#if PERSPECTIVE_CAMERA == 1\\n\\t\\t\\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\\n\\t\\t\\t#else\\n\\t\\t\\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\\n\\t\\t\\t#endif\\n\\t\\t}\\n\\n\\t\\tvoid main() {\\n\\t\\t\\tfloat depth = getDepth( vUv );\\n\\t\\t\\tif( depth >= ( 1.0 - EPSILON ) ) {\\n\\t\\t\\t\\tdiscard;\\n\\t\\t\\t}\\n\\n\\t\\t\\tfloat centerViewZ = -getViewZ( depth );\\n\\t\\t\\tbool rBreak = false, lBreak = false;\\n\\n\\t\\t\\tfloat weightSum = sampleWeights[0];\\n\\t\\t\\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\\n\\n\\t\\t\\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\\n\\n\\t\\t\\t\\tfloat sampleWeight = sampleWeights[i];\\n\\t\\t\\t\\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\\n\\n\\t\\t\\t\\tvec2 sampleUv = vUv + sampleUvOffset;\\n\\t\\t\\t\\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\\n\\n\\t\\t\\t\\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\\n\\n\\t\\t\\t\\tif( ! rBreak ) {\\n\\t\\t\\t\\t\\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\\n\\t\\t\\t\\t\\tweightSum += sampleWeight;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tsampleUv = vUv - sampleUvOffset;\\n\\t\\t\\t\\tviewZ = -getViewZ( getDepth( sampleUv ) );\\n\\n\\t\\t\\t\\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\\n\\n\\t\\t\\t\\tif( ! lBreak ) {\\n\\t\\t\\t\\t\\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\\n\\t\\t\\t\\t\\tweightSum += sampleWeight;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\tgl_FragColor = diffuseSum / weightSum;\\n\\t\\t}\"};exports.DepthLimitedBlurShader=e;const n={createSampleWeights:function(t,e){const n=[];for(let a=0;a<=t;a++)n.push(i(a,e));return n},createSampleOffsets:function(t,e){const n=[];for(let i=0;i<=t;i++)n.push(e.clone().multiplyScalar(i));return n},configure:function(t,e,i,a){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=n.createSampleOffsets(e,a),t.uniforms.sampleWeights.value=n.createSampleWeights(e,i),t.needsUpdate=!0}};function i(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}exports.BlurShaderUtils=n;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":130}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":136}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":138}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":146}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":9,"column":6},"generated":{"line":1,"column":155}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":9,"column":31},"generated":{"line":1,"column":157}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":10,"column":1},"generated":{"line":1,"column":158}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":10,"column":10},"generated":{"line":1,"column":166}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":11,"column":2},"generated":{"line":1,"column":167}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":11,"column":19},"generated":{"line":1,"column":181}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":12,"column":2},"generated":{"line":1,"column":183}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":12,"column":19},"generated":{"line":1,"column":197}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":13,"column":2},"generated":{"line":1,"column":199}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":13,"column":24},"generated":{"line":1,"column":218}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":15,"column":1},"generated":{"line":1,"column":221}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":15,"column":11},"generated":{"line":1,"column":230}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":16,"column":2},"generated":{"line":1,"column":231}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":16,"column":14},"generated":{"line":1,"column":240}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":16,"column":16},"generated":{"line":1,"column":241}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":16,"column":23},"generated":{"line":1,"column":247}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":253}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":10},"generated":{"line":1,"column":258}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":12},"generated":{"line":1,"column":259}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":19},"generated":{"line":1,"column":265}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":23},"generated":{"line":1,"column":269}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":23},"generated":{"line":1,"column":271}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":32},"generated":{"line":1,"column":279}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":17,"column":37},"generated":{"line":1,"column":283}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":2},"generated":{"line":1,"column":289}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":21},"generated":{"line":1,"column":305}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":23},"generated":{"line":1,"column":306}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":30},"generated":{"line":1,"column":312}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":32},"generated":{"line":1,"column":313}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":36},"generated":{"line":1,"column":317}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":36},"generated":{"line":1,"column":319}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":45},"generated":{"line":1,"column":327}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":18,"column":48},"generated":{"line":1,"column":329}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":19,"column":2},"generated":{"line":1,"column":334}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":19,"column":19},"generated":{"line":1,"column":348}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":19,"column":21},"generated":{"line":1,"column":349}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":19,"column":28},"generated":{"line":1,"column":355}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":19,"column":30},"generated":{"line":1,"column":356}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":20,"column":2},"generated":{"line":1,"column":360}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":20,"column":12},"generated":{"line":1,"column":367}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":20,"column":14},"generated":{"line":1,"column":368}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":20,"column":21},"generated":{"line":1,"column":374}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":21,"column":2},"generated":{"line":1,"column":380}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":391}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":21,"column":18},"generated":{"line":1,"column":392}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":21,"column":25},"generated":{"line":1,"column":398}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":22,"column":2},"generated":{"line":1,"column":402}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":22,"column":15},"generated":{"line":1,"column":412}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":22,"column":17},"generated":{"line":1,"column":413}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":22,"column":24},"generated":{"line":1,"column":419}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":23,"column":2},"generated":{"line":1,"column":424}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":23,"column":17},"generated":{"line":1,"column":436}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":23,"column":19},"generated":{"line":1,"column":437}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":23,"column":26},"generated":{"line":1,"column":443}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":25,"column":1},"generated":{"line":1,"column":448}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":25,"column":25},"generated":{"line":1,"column":461}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":41,"column":1},"generated":{"line":1,"column":726}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":41,"column":27},"generated":{"line":1,"column":741}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":166,"column":9},"generated":{"line":1,"column":2838}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":166,"column":9},"generated":{"line":1,"column":2846}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":166,"column":9},"generated":{"line":1,"column":2869}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":119,"column":0},"generated":{"line":1,"column":2871}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":119,"column":6},"generated":{"line":1,"column":2877}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":119,"column":24},"generated":{"line":1,"column":2879}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":121,"column":1},"generated":{"line":1,"column":2880}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":121,"column":22},"generated":{"line":1,"column":2900}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":121,"column":33},"generated":{"line":1,"column":2909}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":121,"column":47},"generated":{"line":1,"column":2911}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":123,"column":2},"generated":{"line":1,"column":2914}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":123,"column":8},"generated":{"line":1,"column":2920}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":123,"column":18},"generated":{"line":1,"column":2922}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":2},"generated":{"line":1,"column":2925}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":8},"generated":{"line":1,"column":2929}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":12},"generated":{"line":1,"column":2933}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":16},"generated":{"line":1,"column":2935}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":19},"generated":{"line":1,"column":2937}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":24},"generated":{"line":1,"column":2940}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":125,"column":38},"generated":{"line":1,"column":2942}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":127,"column":3},"generated":{"line":1,"column":2946}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":127,"column":11},"generated":{"line":1,"column":2948}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":127,"column":17},"generated":{"line":1,"column":2953}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":127,"column":27},"generated":{"line":1,"column":2955}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":127,"column":30},"generated":{"line":1,"column":2957}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":131,"column":2},"generated":{"line":1,"column":2961}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":131,"column":9},"generated":{"line":1,"column":2968}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":135,"column":1},"generated":{"line":1,"column":2971}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":135,"column":22},"generated":{"line":1,"column":2991}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":135,"column":33},"generated":{"line":1,"column":3000}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":135,"column":47},"generated":{"line":1,"column":3002}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":137,"column":2},"generated":{"line":1,"column":3005}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":137,"column":8},"generated":{"line":1,"column":3011}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":137,"column":18},"generated":{"line":1,"column":3013}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":2},"generated":{"line":1,"column":3016}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":8},"generated":{"line":1,"column":3020}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":12},"generated":{"line":1,"column":3024}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":16},"generated":{"line":1,"column":3026}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":19},"generated":{"line":1,"column":3028}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":24},"generated":{"line":1,"column":3031}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":139,"column":38},"generated":{"line":1,"column":3033}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":141,"column":3},"generated":{"line":1,"column":3037}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":141,"column":11},"generated":{"line":1,"column":3039}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":141,"column":17},"generated":{"line":1,"column":3044}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":141,"column":29},"generated":{"line":1,"column":3046}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":141,"column":37},"generated":{"line":1,"column":3054}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":141,"column":53},"generated":{"line":1,"column":3069}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":145,"column":2},"generated":{"line":1,"column":3073}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":145,"column":9},"generated":{"line":1,"column":3080}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":149,"column":1},"generated":{"line":1,"column":3083}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":149,"column":12},"generated":{"line":1,"column":3093}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":149,"column":23},"generated":{"line":1,"column":3102}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":149,"column":33},"generated":{"line":1,"column":3104}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":149,"column":47},"generated":{"line":1,"column":3106}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":149,"column":55},"generated":{"line":1,"column":3108}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":151,"column":2},"generated":{"line":1,"column":3111}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":151,"column":11},"generated":{"line":1,"column":3113}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":151,"column":35},"generated":{"line":1,"column":3121}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":151,"column":40},"generated":{"line":1,"column":3135}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":2},"generated":{"line":1,"column":3137}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":11},"generated":{"line":1,"column":3139}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":38},"generated":{"line":1,"column":3148}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":41},"generated":{"line":1,"column":3164}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":49},"generated":{"line":1,"column":3170}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":65},"generated":{"line":1,"column":3172}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":86},"generated":{"line":1,"column":3192}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":152,"column":100},"generated":{"line":1,"column":3194}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":2},"generated":{"line":1,"column":3197}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":11},"generated":{"line":1,"column":3199}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":36},"generated":{"line":1,"column":3208}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":39},"generated":{"line":1,"column":3222}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":47},"generated":{"line":1,"column":3228}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":63},"generated":{"line":1,"column":3230}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":84},"generated":{"line":1,"column":3250}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":153,"column":98},"generated":{"line":1,"column":3252}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":154,"column":2},"generated":{"line":1,"column":3255}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":154,"column":11},"generated":{"line":1,"column":3257}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":154,"column":25},"generated":{"line":1,"column":3270}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":160,"column":0},"generated":{"line":1,"column":3274}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":160,"column":9},"generated":{"line":1,"column":3283}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":160,"column":19},"generated":{"line":1,"column":3285}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":160,"column":22},"generated":{"line":1,"column":3287}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":1},"generated":{"line":1,"column":3290}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":8},"generated":{"line":1,"column":3297}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":13},"generated":{"line":1,"column":3302}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":22},"generated":{"line":1,"column":3307}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":26},"generated":{"line":1,"column":3309}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":42},"generated":{"line":1,"column":3312}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":51},"generated":{"line":1,"column":3314}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":34},"generated":{"line":1,"column":3316}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":68},"generated":{"line":1,"column":3321}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":73},"generated":{"line":1,"column":3326}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":79},"generated":{"line":1,"column":3331}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":85},"generated":{"line":1,"column":3333}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":90},"generated":{"line":1,"column":3338}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":162,"column":97},"generated":{"line":1,"column":3342}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":166,"column":33},"generated":{"line":1,"column":3345}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":166,"column":33},"generated":{"line":1,"column":3353}},{"source":"../../../src/three/shaders/DepthLimitedBlurShader.js","name":null,"original":{"line":166,"column":33},"generated":{"line":1,"column":3369}}],"sources":{"../../../src/three/shaders/DepthLimitedBlurShader.js":"import {\r\n\tVector2\r\n} from 'three';\r\n\r\n/**\r\n * TODO\r\n */\r\n\r\nconst DepthLimitedBlurShader = {\r\n\tdefines: {\r\n\t\t'KERNEL_RADIUS': 4,\r\n\t\t'DEPTH_PACKING': 1,\r\n\t\t'PERSPECTIVE_CAMERA': 1\r\n\t},\r\n\tuniforms: {\r\n\t\t'tDiffuse': { value: null },\r\n\t\t'size': { value: new Vector2( 512, 512 ) },\r\n\t\t'sampleUvOffsets': { value: [ new Vector2( 0, 0 ) ] },\r\n\t\t'sampleWeights': { value: [ 1.0 ] },\r\n\t\t'tDepth': { value: null },\r\n\t\t'cameraNear': { value: 10 },\r\n\t\t'cameraFar': { value: 1000 },\r\n\t\t'depthCutoff': { value: 10 },\r\n\t},\r\n\tvertexShader: /* glsl */`\r\n\r\n\t\t#include <common>\r\n\r\n\t\tuniform vec2 size;\r\n\r\n\t\tvarying vec2 vUv;\r\n\t\tvarying vec2 vInvSize;\r\n\r\n\t\tvoid main() {\r\n\t\t\tvUv = uv;\r\n\t\t\tvInvSize = 1.0 / size;\r\n\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t}`,\r\n\r\n\tfragmentShader: /* glsl */`\r\n\r\n\t\t#include <common>\r\n\t\t#include <packing>\r\n\r\n\t\tuniform sampler2D tDiffuse;\r\n\t\tuniform sampler2D tDepth;\r\n\r\n\t\tuniform float cameraNear;\r\n\t\tuniform float cameraFar;\r\n\t\tuniform float depthCutoff;\r\n\r\n\t\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\r\n\t\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\r\n\r\n\t\tvarying vec2 vUv;\r\n\t\tvarying vec2 vInvSize;\r\n\r\n\t\tfloat getDepth( const in vec2 screenPosition ) {\r\n\t\t\t#if DEPTH_PACKING == 1\r\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\r\n\t\t\t#else\r\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\r\n\t\t\t#endif\r\n\t\t}\r\n\r\n\t\tfloat getViewZ( const in float depth ) {\r\n\t\t\t#if PERSPECTIVE_CAMERA == 1\r\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\r\n\t\t\t#else\r\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\r\n\t\t\t#endif\r\n\t\t}\r\n\r\n\t\tvoid main() {\r\n\t\t\tfloat depth = getDepth( vUv );\r\n\t\t\tif( depth >= ( 1.0 - EPSILON ) ) {\r\n\t\t\t\tdiscard;\r\n\t\t\t}\r\n\r\n\t\t\tfloat centerViewZ = -getViewZ( depth );\r\n\t\t\tbool rBreak = false, lBreak = false;\r\n\r\n\t\t\tfloat weightSum = sampleWeights[0];\r\n\t\t\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\r\n\r\n\t\t\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\r\n\r\n\t\t\t\tfloat sampleWeight = sampleWeights[i];\r\n\t\t\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\r\n\r\n\t\t\t\tvec2 sampleUv = vUv + sampleUvOffset;\r\n\t\t\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\r\n\r\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\r\n\r\n\t\t\t\tif( ! rBreak ) {\r\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\r\n\t\t\t\t\tweightSum += sampleWeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsampleUv = vUv - sampleUvOffset;\r\n\t\t\t\tviewZ = -getViewZ( getDepth( sampleUv ) );\r\n\r\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\r\n\r\n\t\t\t\tif( ! lBreak ) {\r\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\r\n\t\t\t\t\tweightSum += sampleWeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgl_FragColor = diffuseSum / weightSum;\r\n\t\t}`\r\n\r\n};\r\n\r\nconst BlurShaderUtils = {\r\n\r\n\tcreateSampleWeights: function ( kernelRadius, stdDev ) {\r\n\r\n\t\tconst weights = [];\r\n\r\n\t\tfor ( let i = 0; i <= kernelRadius; i ++ ) {\r\n\r\n\t\t\tweights.push( gaussian( i, stdDev ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn weights;\r\n\r\n\t},\r\n\r\n\tcreateSampleOffsets: function ( kernelRadius, uvIncrement ) {\r\n\r\n\t\tconst offsets = [];\r\n\r\n\t\tfor ( let i = 0; i <= kernelRadius; i ++ ) {\r\n\r\n\t\t\toffsets.push( uvIncrement.clone().multiplyScalar( i ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn offsets;\r\n\r\n\t},\r\n\r\n\tconfigure: function ( material, kernelRadius, stdDev, uvIncrement ) {\r\n\r\n\t\tmaterial.defines[ 'KERNEL_RADIUS' ] = kernelRadius;\r\n\t\tmaterial.uniforms[ 'sampleUvOffsets' ].value = BlurShaderUtils.createSampleOffsets( kernelRadius, uvIncrement );\r\n\t\tmaterial.uniforms[ 'sampleWeights' ].value = BlurShaderUtils.createSampleWeights( kernelRadius, stdDev );\r\n\t\tmaterial.needsUpdate = true;\r\n\r\n\t}\r\n\r\n};\r\n\r\nfunction gaussian( x, stdDev ) {\r\n\r\n\treturn Math.exp( - ( x * x ) / ( 2.0 * ( stdDev * stdDev ) ) ) / ( Math.sqrt( 2.0 * Math.PI ) * stdDev );\r\n\r\n}\r\n\r\nexport { DepthLimitedBlurShader, BlurShaderUtils };\r\n"},"lineCount":null}},"error":null,"hash":"46354517bc8b3c956fe1394a77ebbd50","cacheData":{"env":{}}}